<html>
<head>
	<title>Game Table</title>
	<script src="3rd/paperjs/paper.js" type="text/javascript"></script>
	<script src="3rd/jquery/js/jquery-1.8.0.min.js" type="text/javascript"></script>
	<script src="js/util.js" type="text/javascript"></script>
	<script src="js/card.js" type="text/javascript"></script>
	<script src="js/user.js" type="text/javascript"></script>
	<script src="js/gameHall.js" type="text/javascript"></script>
	<script src="js/gameview.js" type="text/javascript"></script>
	<script type="text/javascript">
		// create the game hall (with just one table)
		if (!localStorage.gameHall) {
			localStorage.gameHall = new GameHall(1, 3);
		}
		// This will mimic storage of the login users on server. I think it will store on the server side eventually.
		if(!localStorage.loginUsers) {
			localStorage.loginUsers = [];
		}
		if(!sessionStorage.loginUser) {
			var sampleUsers = ['Lori', 'Andre', 'Bruce'];
			if(localStorage.loginUsers.length < sampleUsers.length) {
				sessionStorage.loginUser = new User(sampleUsers[localStorage.loginUsers.length]);
				localStorage.loginUsers[localStorage.loginUsers.length.length] = sessionStorage.loginUser;
			}
		}
		
		$(window).bind('onunload', function() {
			localStorage.loginUsers.remove(sessionStorage.loginUser);
		});
	</script>
	<script type="text/paperscript" canvas="paper">

		var gameview = new GameView(paper);
		var players = gameview.init();
        function onMouseDown(event) {
			console.log(event.point);
			//Test if any of the objects have been hit, and store the object
			var options = {segments:true, stroke:true, fill: true, tolerance: 5};
			var hitObject = gameview.hitTest(event.point, options);
			if(hitObject) {
				//console.log(hitObject);
				if(hitObject instanceof Raster) {
					if(hitObject.image && hitObject.name && hitObject.name.substring(0, 4) != 'rear') {
						var card = gameview.findCard(players[0].cards, hitObject.name);
						if(card) {
							if(card.selected) {
								hitObject.position.y = hitObject.position.y + gameview.offset;
								card.selected = false;
							} else {
								hitObject.position.y = hitObject.position.y - gameview.offset;
								card.selected = true;
							}
						}
					}
				} else {
					//hitObject.fillColor = '#EEEEEE';
					hitObject.strokeColor = 'white';
					hitObject.strokeWidth = 4;
					//console.log(hitObject);
				}
			}
        }
        function onMouseUp(event) {
            if(gameview.hitObject) {
				if(gameview.hitObject instanceof Raster) {
				} else {
					//hitObject.fillColor = 'gray';
					gameview.hitObject.strokeColor = 'yellow';
					gameview.hitObject.strokeWidth = 1;
				}
            }
        }
		//function onFrame(event){
			//gameview.deliverCards();
		//}
	</script>
	<style type="text/css">
				body { 
					margin: 0;
					overflow: hidden;
					background-color: #013a65;
					font-family:Helvetica,Arial;
				} 
	</style>
</head>
<body>
	<canvas id="paper" resize></canvas>
	<div id="resContainer"></div>
</body>
</html>